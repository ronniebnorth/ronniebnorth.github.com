---
layout: default
---

<html>
<head>
<style>
html,
  body {
    margin: 0;
    padding: 0;
  }

  .background {
    position: absolute;
    display: block;
    top: 0;
    left: 0;
    z-index: 0;
  }
</style>
<script src="https://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
  crossorigin="anonymous"></script>
<script src="https://formbuilder.online/assets/js/form-render.min.js"></script>

<div id="bj" style="margin: 0 auto;width: 300px; ">
</head>
<body>
      <canvas class="background"></canvas>
      <form id="rendered-form" style="position:relative; z-index:10">
        <div class="rendered-form">
          <div class="">
            <h2 id="control-543579">BlackJackd Simulator</h2>
          </div>
          <div class="fb-number form-group field-number-1511625514395">
            <label for="number-1511625514395" class="fb-number-label">Rounds<span class="fb-required">*</span></label>
            <input style="color:black;width:150px" type="number" class="form-control" name="number-1511625514395" value="1000" min="1" step="1000"
              id="numRounds" required="required" aria-required="true">
          </div>
          <div class="fb-number form-group field-number-1511625576634">
            <label for="number-1511625576634" class="fb-number-label">Players<span class="fb-required">*</span></label>
            <input style="color:black;width:150px" type="number" class="form-control" name="number-1511625576634" value="1" min="1" step="1"
              id="numPlayers" required="required" aria-required="true">
          </div>
          <div class="fb-number form-group field-number-1511625633951">
            <label for="number-1511625633951" class="fb-number-label">Decks<span class="fb-required">*</span></label>
            <input style="color:black;width:150px" type="number" class="form-control" name="number-1511625633951" value="8" min="1" step="1"
              id="numDecks" required="required" aria-required="true">
          </div>
          <div class="fb-button form-group field-button-1511625725834">
            <button style="color:black;width:150px" type="button" class="btn btn-success" name="button-1511625725834" style="success"
              id="btnStart">Run!</button>
          </div>
          <div class="fb-button form-group field-button-1511625725834">
            <p id="pLiveResults">View live results in console..</p>
            <label for="wins" class="fb-number-label">Wins: <span id="wins"></span><br>
            <label for="loss">Loss: <span id="loss"></span><br>
            <label for="runtime">Runtime: <span id="runtime"></span><br>
            <label for="percentage">Win Percentage: <span id="percentage"></span>
          </div>
        </div>
      </form>
      <div id="log"></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particlesjs/2.1.0/particles.min.js"></script>
    <script>



    $(function() {
        Particles.init({
          selector: '.background', color: '#00FFFF'
        });
        $( "#btnStart" ).click(function() {

              start();

        });
    });


    function start(){

        var numPlayers = $("#numPlayers").val();
        var numRounds = $("#numRounds").val();
        var numDecks = $("#numDecks").val();

        var t0 = performance.now();

        var res = playRounds(numPlayers,numRounds,getShoe([],numDecks));

        var t1 = performance.now();

        $("#runtime").text((t1 - t0) + " ms");

        var totWins = res[0];
        var totLoss = res[1];

        console.log('WINS -----', totWins);
        console.log('LOSS -----', totLoss);

        $("#wins").text(totWins);
        $("#loss").text(totLoss);
        var percentage = (totWins/(totWins+totLoss)) * 100;
        $("#percentage").text(percentage + ' %');

    }


    const playRounds = (numPlayers, numRounds, ndeck) => {
        var tscores = [0,0];
        var roundsPlayed = 0;
        while(roundsPlayed < numRounds){

            var rscores = scorePlayers(play(deal(shuffle(ndeck), addPlayers([createDealer()],numPlayers))));

            tscores = sumArrays(tscores,rscores);
            if(roundsPlayed % 10000 === 0){
                var percentage = (tscores[0]/(tscores[0]+tscores[1])) * 100;
                console.log(tscores, percentage);
            }
            roundsPlayed++;
        }
        return tscores;
    }


    const sumArrays = (a1,a2) => {
        return a1.map(function (num, ind) {
            return num + a2[ind];
        });
    }

    const getShoe = (iFullDeck, numDecks) => {
        fullDeck = clone(iFullDeck);
        if(numDecks > 0){
            getShoe(fullDeck.concat(getOneDeck()), numDecks - 1);
        }
        return fullDeck;
    }

    const playerPoints = (player) => {
        return (1 + getDoubleDownPoint(player) + getBlackjackPoint(player));
    }

    const getDoubleDownPoint = (player) => {
        return (player.doubledDown === true) ? 1 : 0;
    }

    const getBlackjackPoint = (player) => {
        return (player.blackjack === true) ? 0.5 : 0;
    }

    const scorePlayer = (player, dealerPoints) => {
        return [
            (playerWon(player, dealerPoints) ? playerPoints(player) : 0),
            (playerLost(player, dealerPoints) ? playerPoints(player) : 0)
        ]
    }

    const playerWon = (player, dealerPoints) => {
        if(player.points > dealerPoints || player.blackjack === true){
            return true;
        }
        return false;
    }

    const playerLost = (player, dealerPoints) => {
        if(player.points < dealerPoints || player.points === 0){
            return true;
        }
        return false;
    }

    const scorePlayers = (players) => {
        var dealerPoints = players[0].points;
        var scores = [0,0];
        for(var i = 1; i < players.length; i++){
            scores = sumArrays(scores,scorePlayer(players[i],dealerPoints));
        }
        return scores;
    }

    const dealerBlackjack = (players) => {
        return players.map(function(player){
            if(player.type == "player" && player.points != 21){
                player.points = 0;
                return player;
            }else{
                return player;
            }
        });
    }

    const play = (game) => {
        var deck = game[0];
        var players = game[1];
        var dealer = players[0];
        var nPlayers = [];

        if(dealer.points == 21){
            nPlayers = dealerBlackjack(players);
        }else{
            var spDeckPly = splitPlayers([deck, players]);
            deck = spDeckPly[0];
            nPlayers = spDeckPly[1];

            nPlayers = nPlayers.map(function(player, ind, plyrs){
                if(player.points == 21){
                    player.blackjack = true;
                    return player;
                }
                if(player.points == 22){
                    player.acesToUse--;
                    player.points = 12;
                }
                var hitResults = hit(deck, players, player);
                deck = hitResults[0];
                var newPlayer = hitResults[1];
                return newPlayer;
            });
        }
        return nPlayers;
    }


    const splitPlayers = (deckPlayers) => {
        var deck = deckPlayers[0];
        var players = deckPlayers[1];
        var newPlayers = [];
        players.map(function(player){
            if(player.canSplit){
                var stratCode = strategize(player, players[0].upcard);
                if(stratCode == 2){
                    player.canSplit = false;
                    var sPlayer = createPlayer();
                    var splitPoints = player.points / 2;
                    sPlayer.points = splitPoints;
                    player.points = splitPoints;

                    var dp = adjustPlayer(1,giveCard(deck, sPlayer));
                    deck = dp[0];
                    sPlayer = dp[1];

                    dp = adjustPlayer(1,giveCard(deck, player));
                    deck = dp[0];
                    player = dp[1];

                    newPlayers.push(sPlayer);
                }
            }
            newPlayers.push(player);
        });
        return [deck, newPlayers];
    }


    const adjustPlayer = (round,dp) => {
        var deck = dp[0];
        var nPlayer = dp[1];
        var card = dp[2];
        if(round == 1 && nPlayer.type == 'dealer'){
            nPlayer.upcard = card;
        }
        if(round == 1 && nPlayer.type == "player" && card === nPlayer.points / 2){
            nPlayer.canSplit = true;
        }
        return [deck,nPlayer];
    }


    const deal = (ideck, players) => {
        var i = 0;
        var deck = clone(ideck);
        while(i < 2){
            players = players.map(function(player){
                var dp = adjustPlayer(i,giveCard(deck, player));
                deck = dp[0];
                return dp[1];
            });
            i++;
        }
        return [deck, players];
    }

    const addPlayers = (players, numPlayers) => {
        if(numPlayers > 0){
          players.push(createPlayer());
          addPlayers(players, numPlayers - 1)
        }
        return players;
    }

    const createDealer = () => {
        return {type:'dealer',points:0,acesToUse:0,upcard:0};
    }

    const createPlayer = () => {
        return {type:'player',points:0,acesToUse:0,doubledDown:false,canSplit:false};
    }


    const shuffle = (arr) => {
        var curInd = arr.length, tempVal, randInd;
        while (0 !== curInd) {
            randInd = Math.floor(Math.random() * curInd);
            curInd -= 1;
            tempVal = arr[curInd];
            arr[curInd] = arr[randInd];
            arr[randInd] = tempVal;
        }
        return arr;
    }


    const giveCard = (deck, player) => {
        var card = deck.pop();

        player.points += card;
        if(card == 11){ player.acesToUse++; }
        player = playAces(player);
        return [deck,player,card];
    }

    const hit = (deck, players, player) => {
        var stratCode = strategize(player, players[0].upcard);
        var dp = [];
        if(player.type == "player" && stratCode == 3){
            player.doubledDown = true;
            dp = giveCard(deck, player);
            deck = dp[0];
            player = dp[1];

        }else{
            while(player.points < 21 && shouldHit(players, player)){
                dp = giveCard(deck, player);
                deck = dp[0];
                player = dp[1];
            }
        }
        if(player.points > 21){
            player.points = 0;
        }
        return [deck, player];
    }


    const shouldHit = (players, player) => {
        if(player.type === 'dealer'){
            return player.points < 17 ? true : false;
        }
        var stratCode = strategize(player, players[0].upcard);
        if(stratCode === 0 || stratCode === 3){
            return true;
        }
        return false;
    }


    const strategize = (player, upcard) => {
        var points = player.points - 1;
        if(player.acesToUse > 0){
            points = points - 10;
        }
        if(upcard == 11){ upcard = 1; }

        if(player.canSplit){
            return getPairStrat(points, upcard-1);
        }else if(player.acesToUse > 0){
            return getSoftStrat(points, upcard-1);
        }else{
            return getHardStrat(points, upcard-1);
        }
    }


    const playAces = (player) => {
        if(player.points > 21){
            if(player.acesToUse > 0){
                player.points -= 10;
                player.acesToUse--;
            }
        }
        return player;
    }


    const clargs = (args) => {
        for(var i = 0; i < args.length; i++){
            args[i] = clone(args[i]);
        }
        return args;
    }


    const clone = (obj) => {
        return JSON.parse(JSON.stringify(obj));
    }


    const getOneDeck = () => {
        return [
            11,2,3,4,5,6,7,8,9,10,10,10,10,
            11,2,3,4,5,6,7,8,9,10,10,10,10,
            11,2,3,4,5,6,7,8,9,10,10,10,10,
            11,2,3,4,5,6,7,8,9,10,10,10,10
        ];
    }

    const getSoftStrat = (points, upcard) => {
        var softStrat = [
            [9,9,9,9,9,9,9,9,9,9],
            [0,0,0,0,0,3,0,0,0,0],
            [0,0,0,0,3,3,0,0,0,0],
            [0,0,0,0,3,3,0,0,0,0],
            [0,0,0,3,3,3,0,0,0,0],
            [0,0,0,3,3,3,0,0,0,0],
            [0,0,3,3,3,3,0,0,0,0],
            [0,1,3,3,3,3,1,1,0,0],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [9,9,9,9,9,9,9,9,9,9],
            [9,9,9,9,9,9,9,9,9,9],
            [9,9,9,9,9,9,9,9,9,9],
            [9,9,9,9,9,9,9,9,9,9],
            [9,9,9,9,9,9,9,9,9,9],
            [9,9,9,9,9,9,9,9,9,9],
            [9,9,9,9,9,9,9,9,9,9],
            [9,9,9,9,9,9,9,9,9,9],
            [9,9,9,9,9,9,9,9,9,9],
            [0,0,0,0,0,0,0,0,0,0]
        ];
        return softStrat[points][upcard];
    }


    const getHardStrat = (points, upcard) => {
        var hardStrat = [
            [9,9,9,9,9,9,9,9,9,9],
            [9,9,9,9,9,9,9,9,9,9],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,3,3,3,3,0,0,0,0],
            [0,3,3,3,3,3,3,3,3,0],
            [0,3,3,3,3,3,3,3,3,3],
            [0,0,0,1,1,1,0,0,0,0],
            [0,1,1,1,1,1,0,0,0,0],
            [0,1,1,1,1,1,0,0,0,0],
            [0,1,1,1,1,1,0,0,0,0],
            [0,1,1,1,1,1,0,0,0,0],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1]
        ];
        return hardStrat[points][upcard];
    }


    const getPairStrat = (points, upcard) => {
        var pairStrat = [
            [9,9,9,9,9,9,9,9,9,9],
            [2,2,2,2,2,2,2,2,2,2],
            [9,9,9,9,9,9,9,9,9,9],
            [0,2,2,2,2,2,2,0,0,0],
            [9,9,9,9,9,9,9,9,9,9],
            [0,2,2,2,2,2,2,0,0,0],
            [9,9,9,9,9,9,9,9,9,9],
            [0,0,0,0,2,2,2,0,0,0],
            [9,9,9,9,9,9,9,9,9,9],
            [0,3,3,3,3,3,3,3,3,0],
            [9,9,9,9,9,9,9,9,9,9],
            [0,2,2,2,2,2,0,0,0,0],
            [9,9,9,9,9,9,9,9,9,9],
            [0,2,2,2,2,2,2,0,0,0],
            [9,9,9,9,9,9,9,9,9,9],
            [2,2,2,2,2,2,2,2,2,2],
            [9,9,9,9,9,9,9,9,9,9],
            [1,2,2,2,2,2,1,2,2,1],
            [9,9,9,9,9,9,9,9,9,9],
            [1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1]
        ];
        return pairStrat[points][upcard];
    }
/*
    (function () {
        var old = console.log;
        var logger = document.getElementById('log');
        console.log = function () {
          for (var i = 0; i < arguments.length; i++) {
            if (typeof arguments[i] == 'object') {
                logger.innerHTML += (JSON && JSON.stringify ? JSON.stringify(arguments[i], undefined, 2) : arguments[i]) + '<br />';
            } else {
                logger.innerHTML += arguments[i] + '<br />';
            }
          }
        }
    })();
*/
    </script>


  </body>
</html>
